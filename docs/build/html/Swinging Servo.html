

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Swinging Servo &mdash; SunFounder Thales Kit for Raspberry Pi Pico 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Turn the Knob" href="Turn the knob.html" />
    <link rel="prev" title="Custom Tone" href="Custom tone.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SunFounder Thales Kit for Raspberry Pi Pico
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction to Raspberry Pi Pico.html">Introduction to Raspberry Pi Pico</a></li>
<li class="toctree-l1"><a class="reference internal" href="What is MicroPython.html">What is MicroPython?</a></li>
<li class="toctree-l1"><a class="reference internal" href="Thonny Python IDE.html">Thonny Python IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="Your First MicroPython Program.html">Your First MicroPython Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="MicroPython Basic Syntax.html">MicroPython Basic Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="Components Introduction.html">Components Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Lesson.html">Lessons</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="First program! Hello, LED!.html">Hello, LED!</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hello, Breadboard!.html">Hello, Breadboard!</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading_button_values.html">Reading Button Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reaction Game.html">Reaction Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="Traffic light.html">Traffic Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hello, Transistor!.html">Two Kinds of Transistors</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intruder Alarm.html">Intruder Alarm</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fading LED.html">Fading LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="Colorful Light.html">Colorful Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="Custom tone.html">Custom Tone</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Swinging Servo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wiring">Wiring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code">Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it works?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Turn the knob.html">Turn the Knob</a></li>
<li class="toctree-l2"><a class="reference internal" href="Thermometer.html">Thermometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Light Theremin.html">Light Theremin</a></li>
<li class="toctree-l2"><a class="reference internal" href="Microchip - 74HC595.html">Microchip - 74HC595</a></li>
<li class="toctree-l2"><a class="reference internal" href="LED Segment Display.html">LED Segment Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="Liquid Crystal Display.html">Liquid Crystal Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="RGB LED Strip.html">RGB LED Strip</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SunFounder Thales Kit for Raspberry Pi Pico</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="Lesson.html">Lessons</a> &raquo;</li>
        
      <li>Swinging Servo</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Swinging Servo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="swinging-servo">
<h1>Swinging Servo<a class="headerlink" href="#swinging-servo" title="Permalink to this headline">¶</a></h1>
<p>本套件除了LED和无源蜂鸣器，另一个由PWM信号控制的设备是Servo。</p>
<p>舵机是一种位置（角度）伺服的驱动器，适用于那些需要角度不断变化并可以保持的控制系统。在高档遥控玩具，如飞机、潜艇模型，遥控机器人中已经得到了普遍应用。</p>
<p>让舵机摇摆起来吧！</p>
<div class="section" id="wiring">
<h2>Wiring<a class="headerlink" href="#wiring" title="Permalink to this headline">¶</a></h2>
<img alt="_images/wiring_swing_servo.png" src="_images/wiring_swing_servo.png" />
<ol class="arabic simple">
<li><p>将Servo Arm 按到在Servo的输出轴上。如果有必要，使用螺丝将其固定。</p></li>
<li><p>将 Pico 的 <strong>VBUS</strong> （不是3V3）和 GND 连接至面包板的电源总线。</p></li>
<li><p>让舵机的红色引线用跳线连接至正极电源总线。</p></li>
<li><p>让舵机的黄色引线用跳线连接 GP15 引脚。</p></li>
<li><p>让舵机的黑色引线用跳线连接至负极电源总线。</p></li>
</ol>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">import</span> <span class="nn">utime</span>

<span class="n">servo</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">servo</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">interval_mapping</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">in_min</span><span class="p">,</span> <span class="n">in_max</span><span class="p">,</span> <span class="n">out_min</span><span class="p">,</span> <span class="n">out_max</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">in_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">out_max</span> <span class="o">-</span> <span class="n">out_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">in_max</span> <span class="o">-</span> <span class="n">in_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">out_min</span>

<span class="k">def</span> <span class="nf">servo_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="n">pulse_width</span><span class="o">=</span><span class="n">interval_mapping</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">duty</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">interval_mapping</span><span class="p">(</span><span class="n">pulse_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">65535</span><span class="p">))</span>
    <span class="n">pin</span><span class="o">.</span><span class="n">duty_u16</span><span class="p">(</span><span class="n">duty</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">180</span><span class="p">):</span>
        <span class="n">servo_write</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">servo_write</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>当程序运行时，我们能看到Servo Arm从0°到180°来回摇摆。因为 <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> 循环的原因程序会一直运行，我们需要按下Stop键来结束这个程序。</p>
</div>
<div class="section" id="how-it-works">
<h2>How it works?<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>我们定义了 <code class="docutils literal notranslate"><span class="pre">servo_write()</span></code> 函数来让舵机动起来。</p>
<p>这个函数拥有两个parameter:</p>
<ul class="simple">
<li><p>pin，控制舵机的GPIO引脚。</p></li>
<li><p>angle，舵机轴输出的角度。</p></li>
</ul>
<p>在这个函数中调用了 <code class="docutils literal notranslate"><span class="pre">interval_mapping()</span></code> 将角度范围 0 ~ 180 映射为pulse width的范围 0.5 ~ 2.5ms。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pulse_width</span><span class="o">=</span><span class="n">interval_mapping</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<p>为什么是0.5~2.5呢？这是由舵机的工作方式所决定的。</p>
<img alt="_images/servo1.png" src="_images/servo1.png" />
<p>It works like this: The microcontroller sends out PWM signals to the servo, and then the embedded board in the servo receives the signals through the signal pin and controls the motor inside to turn.
As a result, the motor drives the gear system and then motivates the shaft after deceleration.
The shaft and potentiometer of the servo are connected together.
When the shaft rotates, it drives the potentiometer, so the potentiometer outputs a voltage signal to the embedded board.
Then the board determines the direction and speed of rotation based on the current position, so it can stop exactly at the right position as defined and hold there.</p>
<img alt="_images/servo3.png" src="_images/servo3.png" />
<p>The angle is determined by the duration of a pulse that is applied to the control wire. The servo expects to see a pulse every 20 ms (That’s why we set the pwm frequency to 50hz).</p>
<p>The length of the pulse will determine how far the motor turns.
For example, a 1.5ms pulse will make the motor turn to the 90 degree position (neutral position).
When a pulse is sent to a servo that is less than 1.5 ms, the servo rotates to a position and holds its output shaft some degrees counterclockwise from the neutral point.
When the pulse is wider than 1.5 ms the opposite occurs. The minimal width and the maximum width of pulse that will command the servo to turn to a valid position are functions of each servo.
Generally the minimum pulse will be about 0.5 ms wide and the maximum pulse will be 2.5 ms wide.</p>
<p>接下来将pulse width转化从周期转化为duty，由于duty_u16()在使用时不可以有小数（数值不能为float类型），我们使用了 <code class="docutils literal notranslate"><span class="pre">int()</span></code> 将duty强制转化为int类型。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duty</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">interval_mapping</span><span class="p">(</span><span class="n">pulse_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">65535</span><span class="p">))</span>
</pre></div>
</div>
<p>最后将duty值写入duty_u16()即可。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Turn the knob.html" class="btn btn-neutral float-right" title="Turn the Knob" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Custom tone.html" class="btn btn-neutral float-left" title="Custom Tone" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SunFounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>